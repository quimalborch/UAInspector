# UAInspector - Project Architecture

## ?? Architecture Overview

UAInspector follows the **MVVM (Model-View-ViewModel)** pattern with a clean separation of concerns.

```
???????????????????????????????????????????????????????????
?        VIEW            ?
?  (XAML - User Interface)           ?
?  ????????????????  ????????????????  ???????????????? ?
?  ? MainWindow   ?  ?ServerListView?  ? ExplorerView ?  ?
?  ????????????????  ????????????????????????????????  ?
????????????????????????????????????????????????????????????
          ?          ?     ?
          ? Data Binding   ?            ?
          ?            ?         ?
???????????????????????????????????????????????????????????
?   VIEWMODEL     ?
?  (C# - UI Logic & State)        ?
?  ????????????????  ????????????????  ????????????????  ?
?  ? MainViewModel?  ?ServerListVM  ?  ? ExplorerVM   ?  ?
?  ????????????????  ????????????????  ????????????????  ?
????????????????????????????????????????????????????????????
        ?   ?          ?
          ? Uses           ?   ?
          ?        ?      ?
???????????????????????????????????????????????????????????
?             SERVICES & MODELS            ?
?  (Business Logic & Data)   ?
?  ????????????????  ????????????????  ????????????????  ?
?  ?OpcClientSvc  ?  ?StorageService?  ?DiscoverySvc  ?  ?
?  ????????????????  ????????????????  ????????????????  ?
?  ????????????????  ????????????????  ????????????????  ?
?  ?OpcServerInfo ?  ? OpcNodeInfo  ?  ? AppSettings  ?  ?
?  ????????????????  ????????????????  ????????????????  ?
???????????????????????????????????????????????????????????
```

## ?? Directory Structure

```
UAInspector/
?
??? ?? Core/         # Business logic layer
?   ??? ?? Models/           # Data models
?   ?   ??? OpcServerInfo.cs      # Server information
?   ?   ??? OpcNodeInfo.cs          # OPC UA node
?   ?   ??? AppSettings.cs        # Application settings
?   ?   ??? LoginType.cs            # Authentication enum
?   ?
?   ??? ?? Services/  # Business services
?  ??? OpcClientService.cs     # ? OPC UA client operations
?       ??? DiscoveryService.cs     # ? Server discovery
?       ??? CertificateManager.cs   # ? Certificate management
?   ??? StorageService.cs   # ? Local data persistence
?
??? ?? ViewModels/         # Presentation logic
?   ??? ViewModelBase.cs            # ? Base ViewModel
?   ??? RelayCommand.cs             # ? Command implementation
?   ??? MainViewModel.cs          # ? Main window VM
?   ??? ServerListViewModel.cs     # ? Server list VM
?   ??? LoginViewModel.cs        # ? Login dialog VM
?   ??? ExplorerViewModel.cs        # ? Node browser VM
?   ??? SettingsViewModel.cs        # ? Settings VM
?
??? ?? Views/  # User interface (XAML)
?   ??? ServerListView.xaml         # ? Server list UI
?   ??? ServerListView.xaml.cs      # ? Code-behind
?   ??? LoginView.xaml         # ? Login dialog
?   ??? ExplorerView.xaml       # ? Node browser
?   ??? SettingsView.xaml           # ? Settings UI
?
??? ?? Resources/       # Shared resources
?   ??? Styles.xaml   # ? UI styles & themes
?   ??? Icons/          # ? Icon resources
???? Images/         # ? Image resources
?
??? ?? Helpers/            # ? Utility classes
?   ??? Converters/    # Value converters
?   ??? Extensions/      # Extension methods
?
??? ?? Properties/     # Project properties
?   ??? AssemblyInfo.cs        # Assembly metadata
?   ??? Resources.resx              # String resources
?   ??? Settings.settings         # App settings
?
??? MainWindow.xaml         # ? Main application window
??? MainWindow.xaml.cs       # ? Main window code-behind
??? App.xaml  # ? Application definition
??? App.xaml.cs      # ? Application startup
??? App.config      # Application configuration

Legend:
? Implemented
? Planned/To be implemented
```

## ?? Data Flow

### 1. Application Startup
```
App.xaml.cs (OnStartup)
    ?
MainWindow.xaml.cs (Constructor)
    ?
MainViewModel (Constructor)
    ?
StorageService.LoadSettings()
    ?
ServerListViewModel (shown by default)
```

### 2. Server Connection Flow
```
User clicks "Connect" in UI
    ?
ServerListView (Button Click)
    ?
ServerListViewModel.ConnectCommand
    ?
OpcClientService.ConnectAsync()
    ?
MainViewModel.OnConnected()
    ?
UI updates (status, navigation enabled)
```

### 3. Node Browsing Flow (Future)
```
User expands node in TreeView
    ?
ExplorerView (TreeViewItem.Expanded)
    ?
ExplorerViewModel.LoadChildrenCommand
    ?
OpcClientService.BrowseAsync(nodeId)
    ?
ObservableCollection<OpcNodeInfo> updated
    ?
UI automatically updates (data binding)
```

## ?? MVVM Pattern Implementation

### View (XAML)
- **Responsibility**: Define UI structure and appearance
- **Communication**: Data binding to ViewModel
- **Example**: `ServerListView.xaml`

```xaml
<!-- Binds to ViewModel property -->
<TextBox Text="{Binding ManualUrl, UpdateSourceTrigger=PropertyChanged}"/>

<!-- Binds to ViewModel command -->
<Button Command="{Binding ConnectCommand}"/>
```

### ViewModel (C#)
- **Responsibility**: UI logic, state management, commands
- **Communication**: Implements INotifyPropertyChanged, uses Services
- **Example**: `ServerListViewModel.cs`

```csharp
public class ServerListViewModel : ViewModelBase
{
  private string _manualUrl;
    
    // Property with change notification
    public string ManualUrl
    {
        get => _manualUrl;
        set => SetProperty(ref _manualUrl, value);
    }
    
    // Command bound to UI
 public ICommand ConnectCommand { get; }
    
    // Uses services
    private readonly StorageService _storage;
}
```

### Model (C#)
- **Responsibility**: Data structure, business rules
- **Communication**: Used by ViewModels and Services
- **Example**: `OpcServerInfo.cs`

```csharp
public class OpcServerInfo
{
    public string Id { get; set; }
    public string Name { get; set; }
    public string Url { get; set; }
    // ... other properties
}
```

### Service (C#)
- **Responsibility**: Business logic, data access, external APIs
- **Communication**: Called by ViewModels
- **Example**: `StorageService.cs`

```csharp
public class StorageService
{
    public List<OpcServerInfo> LoadServers() { }
 public void SaveServers(List<OpcServerInfo> servers) { }
}
```

## ?? Key Design Patterns Used

### 1. MVVM (Model-View-ViewModel)
- Separates UI from business logic
- Enables testability
- Supports data binding

### 2. Command Pattern
- `RelayCommand` encapsulates actions
- Supports CanExecute logic
- Automatic UI enable/disable

### 3. Observer Pattern
- `INotifyPropertyChanged` for property changes
- `ObservableCollection<T>` for collection changes
- Automatic UI updates

### 4. Dependency Injection (Manual)
- Services passed to ViewModels
- Loosely coupled components
- Easy to test and mock

### 5. Repository Pattern
- `StorageService` abstracts data access
- Can switch from XML to database easily
- Single point of data operations

## ?? Component Responsibilities

### MainViewModel
- Application-wide state
- Navigation between views
- Connection status
- Status messages

### ServerListViewModel
- Server list management
- Server discovery
- Connection initiation
- URL validation

### ExplorerViewModel (Future)
- Node tree navigation
- Node selection
- Read/write operations
- Subscription management

### OpcClientService (Future)
- OPC UA session management
- Browse operations
- Read/Write operations
- Subscriptions

### StorageService
- Persist server history
- Save/load settings
- Store favorite nodes
- XML serialization

## ?? State Management

### Application State
```
MainViewModel
??? IsConnected: bool
??? StatusMessage: string
??? CurrentViewModel: ViewModelBase
??? Settings: AppSettings
```

### Server List State
```
ServerListViewModel
??? Servers: ObservableCollection<OpcServerInfo>
??? SelectedServer: OpcServerInfo
??? DiscoveredServers: ObservableCollection<OpcServerInfo>
??? IsDiscovering: bool
??? ManualUrl: string
```

## ?? Event Flow

### Property Changed Event
```
1. User types in TextBox
2. Two-way binding updates ViewModel property
3. Setter calls SetProperty()
4. PropertyChanged event raised
5. UI automatically updates (if bound elsewhere)
```

### Command Execution
```
1. User clicks Button
2. Button checks Command.CanExecute()
3. If true, Button calls Command.Execute()
4. RelayCommand calls action delegate
5. ViewModel method executes
6. ViewModel updates properties
7. UI reflects changes via data binding
```

## ?? Styling Architecture

### Style Hierarchy
```
App.xaml (Global Resources)
    ?
Resources/Styles.xaml
    ??? Colors (primitives)
    ??? Brushes (from colors)
    ??? Base Styles (Button, TextBox, etc.)
    ??? Derived Styles (ModernButton, SecondaryButton)
   ?
Views use {StaticResource StyleName}
```

### Resource Resolution
1. Look in element's Resources
2. Look in parent's Resources
3. Look in Window.Resources
4. Look in App.Resources
5. Look in merged ResourceDictionaries
6. Look in system resources

## ?? Extension Points

### Adding New View
1. Create XAML file in `Views/`
2. Create ViewModel in `ViewModels/`
3. Add DataTemplate to `MainWindow.xaml`
4. Add navigation command to `MainViewModel`

### Adding New Service
1. Create service class in `Core/Services/`
2. Inject into ViewModels via constructor
3. Call service methods from ViewModel
4. Update UI via data binding

### Adding New Model
1. Create class in `Core/Models/`
2. Add properties as needed
3. Use in ViewModels and Services
4. Bind to UI if needed

## ?? Best Practices Implemented

? **Separation of Concerns**: UI, logic, and data are separate
? **Single Responsibility**: Each class has one job
? **DRY (Don't Repeat Yourself)**: Shared base classes
? **SOLID Principles**: Especially Open/Closed and Dependency Inversion
? **Data Binding**: Minimal code-behind
? **Async/Await**: For non-blocking operations
? **Error Handling**: Try-catch in service methods
? **Resource Management**: Using statements for IDisposable

## ?? Performance Considerations

- **Lazy Loading**: Only load data when needed
- **Virtual Collections**: Use for large lists
- **Async Operations**: Don't block UI thread
- **Weak References**: For event subscriptions
- **Dispose Pattern**: Clean up resources properly

---

**Architecture Status**: ? Well-structured and ready for OPC UA implementation
