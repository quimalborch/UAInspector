<UserControl x:Class="UAInspector.Views.ExplorerView"
       xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d" 
   d:DesignHeight="600" d:DesignWidth="1200">
    
  <Grid Background="{StaticResource BackgroundBrush}">
    <Grid.RowDefinitions>
       <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

 <!-- Header -->
    <Border Grid.Row="0" Background="{StaticResource SurfaceBrush}" 
          BorderBrush="{StaticResource BorderBrush}"
     BorderThickness="0,0,0,1" Padding="24,16">
  <Grid>
    <Grid.ColumnDefinitions>
 <ColumnDefinition Width="*"/>
    <ColumnDefinition Width="Auto"/>
          </Grid.ColumnDefinitions>

          <!-- Server Info -->
              <StackPanel Grid.Column="0">
     <TextBlock Text="OPC UA Address Space Explorer" 
Style="{StaticResource HeaderText}"/>
 <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
   <TextBlock Text="??" FontSize="12" VerticalAlignment="Center" Margin="0,0,8,0"/>
          <TextBlock VerticalAlignment="Center" FontSize="12" 
         Foreground="{StaticResource TextSecondaryBrush}">
       <Run Text="Connected to:"/>
     <Run Text="{Binding ServerName, Mode=OneWay}" FontWeight="SemiBold"/>
   </TextBlock>
        </StackPanel>
      </StackPanel>

     <!-- Toolbar -->
            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
    <Button Content="?? Refresh" 
       Command="{Binding RefreshCommand}"
      Style="{StaticResource SecondaryButton}"
           Margin="0,0,8,0" Padding="16,8"/>
       <Button Content="?? Search" 
    Command="{Binding SearchCommand}"
          Style="{StaticResource SecondaryButton}"
    Padding="16,8"/>
   </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="24">
            <Grid.ColumnDefinitions>
      <ColumnDefinition Width="1.5*"/>
         <ColumnDefinition Width="20"/>
    <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

      <!-- Left Panel: Node Tree -->
   <Border Grid.Column="0" Style="{StaticResource Card}">
   <Grid>
   <Grid.RowDefinitions>
     <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
         </Grid.RowDefinitions>

      <!-- Title -->
         <TextBlock Grid.Row="0" Text="Address Space" 
 Style="{StaticResource SubHeaderText}"/>

         <!-- TreeView -->
    <TreeView Grid.Row="1" 
       ItemsSource="{Binding RootNodes}"
Background="Transparent"
       BorderThickness="0"
   Margin="0,8,0,0"
  ScrollViewer.HorizontalScrollBarVisibility="Auto">
           <TreeView.ItemContainerStyle>
    <Style TargetType="TreeViewItem">
                <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"/>
   <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
   <Setter Property="Padding" Value="4"/>
      <EventSetter Event="Expanded" Handler="TreeViewItem_Expanded"/>
  <EventSetter Event="Selected" Handler="TreeViewItem_Selected"/>
      <Style.Triggers>
           <Trigger Property="IsSelected" Value="True">
      <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
<Setter Property="Foreground" Value="White"/>
  </Trigger>
   <Trigger Property="IsMouseOver" Value="True">
 <Setter Property="Background" Value="{StaticResource HoverBrush}"/>
      </Trigger>
            </Style.Triggers>
    </Style>
        </TreeView.ItemContainerStyle>
         <TreeView.ItemTemplate>
                 <HierarchicalDataTemplate ItemsSource="{Binding Children}">
     <StackPanel Orientation="Horizontal" Margin="2">
              <!-- Icon based on NodeClass -->
<TextBlock VerticalAlignment="Center" Margin="0,0,8,0" FontSize="14">
 <TextBlock.Style>
           <Style TargetType="TextBlock">
 <Setter Property="Text" Value="??"/>
               <Style.Triggers>
    <DataTrigger Binding="{Binding NodeClass}" Value="Variable">
               <Setter Property="Text" Value="??"/>
         </DataTrigger>
    <DataTrigger Binding="{Binding NodeClass}" Value="Method">
             <Setter Property="Text" Value="??"/>
      </DataTrigger>
               <DataTrigger Binding="{Binding NodeClass}" Value="ObjectType">
        <Setter Property="Text" Value="???"/>
           </DataTrigger>
    </Style.Triggers>
    </Style>
                     </TextBlock.Style>
                 </TextBlock>
          
    <!-- Node Name -->
  <TextBlock Text="{Binding DisplayName}" 
              VerticalAlignment="Center"
 FontSize="13"/>
             </StackPanel>
           </HierarchicalDataTemplate>
              </TreeView.ItemTemplate>
         </TreeView>

      <!-- Loading Indicator -->
            <Border Grid.Row="1" 
                 Background="#AA000000" 
 VerticalAlignment="Stretch"
   HorizontalAlignment="Stretch">
        <Border.Style>
                <Style TargetType="Border">
    <Setter Property="Visibility" Value="Collapsed"/>
     <Style.Triggers>
                 <DataTrigger Binding="{Binding IsLoading}" Value="True">
          <Setter Property="Visibility" Value="Visible"/>
      </DataTrigger>
         </Style.Triggers>
           </Style>
    </Border.Style>
  <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
         <TextBlock Text="?" FontSize="48" HorizontalAlignment="Center"/>
      <TextBlock Text="Loading nodes..." 
             Foreground="White" 
            FontSize="14"
   Margin="0,8,0,0"
HorizontalAlignment="Center"/>
   </StackPanel>
           </Border>
      </Grid>
        </Border>

        <!-- Right Panel: Node Details & Monitoring -->
   <Grid Grid.Column="2">
              <Grid.RowDefinitions>
             <RowDefinition Height="1.2*"/>
          <RowDefinition Height="16"/>
    <RowDefinition Height="*"/>
       </Grid.RowDefinitions>

      <!-- Node Details -->
       <Border Grid.Row="0" Style="{StaticResource Card}">
        <Grid>
      <Grid.RowDefinitions>
       <RowDefinition Height="Auto"/>
        <RowDefinition Height="*"/>
             <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

       <!-- Title -->
       <TextBlock Grid.Row="0" Text="Node Details" 
  Style="{StaticResource SubHeaderText}"/>

  <!-- Details Content -->
         <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="0,8,0,0">
          <StackPanel>
       <StackPanel.Style>
       <Style TargetType="StackPanel">
      <Setter Property="Visibility" Value="Visible"/>
     <Style.Triggers>
    <DataTrigger Binding="{Binding IsNodeSelected}" Value="False">
         <Setter Property="Visibility" Value="Collapsed"/>
       </DataTrigger>
</Style.Triggers>
          </Style>
      </StackPanel.Style>

   <!-- Display Name -->
              <TextBlock Text="Display Name" FontSize="11" 
             Foreground="{StaticResource TextSecondaryBrush}" 
      Margin="0,0,0,4"/>
       <TextBlock Text="{Binding SelectedNode.DisplayName}" 
            FontSize="14" FontWeight="SemiBold"
  Foreground="{StaticResource TextPrimaryBrush}"
      Margin="0,0,0,12"/>

                <!-- Node ID -->
 <TextBlock Text="Node ID" FontSize="11" 
       Foreground="{StaticResource TextSecondaryBrush}" 
        Margin="0,0,0,4"/>
       <Grid Margin="0,0,0,12">
    <Grid.ColumnDefinitions>
         <ColumnDefinition Width="*"/>
  <ColumnDefinition Width="Auto"/>
     </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" 
        Text="{Binding SelectedNode.NodeId}" 
             FontSize="12" FontFamily="Consolas"
            Foreground="{StaticResource TextPrimaryBrush}"
        TextWrapping="Wrap"/>
  <Button Grid.Column="1" Content="??" 
        Command="{Binding CopyNodeIdCommand}"
   ToolTip="Copy Node ID"
   Style="{StaticResource SecondaryButton}"
  Padding="8,4" Margin="8,0,0,0"/>
     </Grid>

        <!-- Node Class -->
              <TextBlock Text="Node Class" FontSize="11" 
  Foreground="{StaticResource TextSecondaryBrush}" 
        Margin="0,0,0,4"/>
         <TextBlock Text="{Binding SelectedNode.NodeClass}" 
         FontSize="13"
    Foreground="{StaticResource AccentBrush}"
       Margin="0,0,0,12"/>

       <!-- Data Type (Variables only) -->
       <StackPanel>
           <StackPanel.Style>
          <Style TargetType="StackPanel">
 <Setter Property="Visibility" Value="Collapsed"/>
   <Style.Triggers>
       <DataTrigger Binding="{Binding SelectedNode.NodeClass}" Value="Variable">
  <Setter Property="Visibility" Value="Visible"/>
         </DataTrigger>
      </Style.Triggers>
       </Style>
         </StackPanel.Style>

       <TextBlock Text="Data Type" FontSize="11" 
          Foreground="{StaticResource TextSecondaryBrush}" 
 Margin="0,0,0,4"/>
             <TextBlock Text="{Binding SelectedNode.DataType}" 
          FontSize="13"
         Foreground="{StaticResource TextPrimaryBrush}"
               Margin="0,0,0,12"/>

    <!-- Current Value -->
             <TextBlock Text="Current Value" FontSize="11" 
             Foreground="{StaticResource TextSecondaryBrush}" 
                  Margin="0,0,0,4"/>
     <Border Background="{StaticResource SurfaceBrush}" 
          BorderBrush="{StaticResource BorderBrush}"
     BorderThickness="1" 
          CornerRadius="4" 
           Padding="12,8"
       Margin="0,0,0,8">
        <StackPanel>
         <TextBlock Text="{Binding SelectedNode.Value}" 
          FontSize="16" FontWeight="SemiBold"
       Foreground="{StaticResource AccentBrush}"/>
    <TextBlock FontSize="10" 
          Foreground="{StaticResource TextSecondaryBrush}"
        Margin="0,4,0,0">
      <Run Text="Updated:"/>
      <Run Text="{Binding SelectedNode.Timestamp, StringFormat='{}{0:HH:mm:ss}'}"/>
              </TextBlock>
          </StackPanel>
    </Border>

              <!-- Quality -->
           <TextBlock Text="Quality" FontSize="11" 
Foreground="{StaticResource TextSecondaryBrush}" 
                 Margin="0,0,0,4"/>
    <TextBlock Text="{Binding SelectedNode.Quality}" 
  FontSize="12"
     Foreground="{StaticResource SuccessBrush}"
         Margin="0,0,0,12"/>
          </StackPanel>
       </StackPanel>
</ScrollViewer>

          <!-- Empty State -->
     <StackPanel Grid.Row="1" 
        VerticalAlignment="Center" 
         HorizontalAlignment="Center">
     <StackPanel.Style>
     <Style TargetType="StackPanel">
      <Setter Property="Visibility" Value="Collapsed"/>
        <Style.Triggers>
        <DataTrigger Binding="{Binding IsNodeSelected}" Value="False">
     <Setter Property="Visibility" Value="Visible"/>
        </DataTrigger>
      </Style.Triggers>
</Style>
      </StackPanel.Style>
     <TextBlock Text="??" FontSize="48" 
       HorizontalAlignment="Center"
     Opacity="0.3"/>
      <TextBlock Text="Select a node to view details" 
                FontSize="13"
           Foreground="{StaticResource TextSecondaryBrush}"
               HorizontalAlignment="Center"
          Margin="0,8,0,0"/>
           </StackPanel>

  <!-- Action Buttons -->
       <StackPanel Grid.Row="2" Margin="0,12,0,0">
      <StackPanel.Style>
  <Style TargetType="StackPanel">
    <Setter Property="Visibility" Value="Collapsed"/>
             <Style.Triggers>
        <DataTrigger Binding="{Binding SelectedNode.NodeClass}" Value="Variable">
        <Setter Property="Visibility" Value="Visible"/>
          </DataTrigger>
     </Style.Triggers>
         </Style>
                   </StackPanel.Style>

<!-- Read Button -->
       <Button Content="?? Read Value" 
                 Command="{Binding ReadValueCommand}"
      Style="{StaticResource ModernButton}"
            HorizontalAlignment="Stretch"
                 Padding="0,10"
      Margin="0,0,0,8"/>

     <!-- Write Section -->
       <StackPanel>
          <StackPanel.Style>
        <Style TargetType="StackPanel">
      <Setter Property="IsEnabled" Value="False"/>
   <Setter Property="Opacity" Value="0.5"/>
          <Style.Triggers>
             <DataTrigger Binding="{Binding CanWrite}" Value="True">
          <Setter Property="IsEnabled" Value="True"/>
  <Setter Property="Opacity" Value="1"/>
  </DataTrigger>
  </Style.Triggers>
          </Style>
        </StackPanel.Style>

     <TextBox Text="{Binding WriteValue, UpdateSourceTrigger=PropertyChanged}"
  Style="{StaticResource ModernTextBox}"
               Margin="0,0,0,8">
 <TextBox.InputBindings>
   <KeyBinding Key="Enter" Command="{Binding WriteValueCommand}"/>
             </TextBox.InputBindings>
   </TextBox>
        <Button Content="?? Write Value" 
      Command="{Binding WriteValueCommand}"
    Style="{StaticResource ModernButton}"
              HorizontalAlignment="Stretch"
     Padding="0,10"
           Margin="0,0,0,8"/>
           </StackPanel>

         <!-- Monitor Button -->
 <Button Content="??? Monitor Changes" 
          Command="{Binding MonitorNodeCommand}"
             Style="{StaticResource SecondaryButton}"
                 HorizontalAlignment="Stretch"
Padding="0,10"/>
         </StackPanel>
        </Grid>
          </Border>

    <!-- Monitored Nodes -->
   <Border Grid.Row="2" Style="{StaticResource Card}">
          <Grid>
          <Grid.RowDefinitions>
 <RowDefinition Height="Auto"/>
   <RowDefinition Height="*"/>
         </Grid.RowDefinitions>

    <!-- Title & Clear Button -->
                <Grid Grid.Row="0">
  <TextBlock Text="Monitored Nodes" 
   Style="{StaticResource SubHeaderText}"
             VerticalAlignment="Center"/>
          <Button Content="??? Clear All" 
      Command="{Binding ClearMonitoredCommand}"
         Style="{StaticResource SecondaryButton}"
                 HorizontalAlignment="Right"
       Padding="12,6"
FontSize="11"/>
         </Grid>

         <!-- Monitored List -->
             <ListBox Grid.Row="1" 
             ItemsSource="{Binding MonitoredNodes}"
    Background="Transparent"
        BorderThickness="0"
          Margin="0,8,0,0"
                   ScrollViewer.HorizontalScrollBarVisibility="Disabled">
    <ListBox.ItemContainerStyle>
     <Style TargetType="ListBoxItem">
  <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
          <Setter Property="Padding" Value="0"/>
          <Setter Property="Margin" Value="0,0,0,8"/>
    <Setter Property="Template">
         <Setter.Value>
              <ControlTemplate TargetType="ListBoxItem">
  <ContentPresenter/>
                 </ControlTemplate>
                    </Setter.Value>
           </Setter>
</Style>
         </ListBox.ItemContainerStyle>
             <ListBox.ItemTemplate>
             <DataTemplate>
             <Border Background="{StaticResource SurfaceBrush}" 
     BorderBrush="{StaticResource BorderBrush}"
    BorderThickness="1" 
   CornerRadius="4" 
   Padding="12">
          <Grid>
        <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
     <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

           <!-- Node Name -->
          <TextBlock Grid.Row="0" 
        Text="{Binding DisplayName}" 
        FontSize="13" FontWeight="SemiBold"
Foreground="{StaticResource TextPrimaryBrush}"/>

       <!-- Value -->
      <TextBlock Grid.Row="1" 
           Text="{Binding Value}" 
      FontSize="16" FontWeight="Bold"
          Foreground="{StaticResource AccentBrush}"
      Margin="0,4,0,0"/>

            <!-- Timestamp -->
 <TextBlock Grid.Row="2" 
       FontSize="10"
   Foreground="{StaticResource TextSecondaryBrush}"
   Margin="0,4,0,0">
  <Run Text="Updated:"/>
           <Run Text="{Binding Timestamp, StringFormat='{}{0:HH:mm:ss.fff}'}"/>
      </TextBlock>
       </Grid>
          </Border>
   </DataTemplate>
              </ListBox.ItemTemplate>
          </ListBox>

                 <!-- Empty State -->
        <StackPanel Grid.Row="1" 
      VerticalAlignment="Center" 
              HorizontalAlignment="Center">
       <StackPanel.Style>
                  <Style TargetType="StackPanel">
        <Setter Property="Visibility" Value="Collapsed"/>
             <Style.Triggers>
         <DataTrigger Binding="{Binding MonitoredNodes.Count}" Value="0">
      <Setter Property="Visibility" Value="Visible"/>
      </DataTrigger>
      </Style.Triggers>
             </Style>
       </StackPanel.Style>
         <TextBlock Text="???" FontSize="36" 
             HorizontalAlignment="Center"
           Opacity="0.3"/>
          <TextBlock Text="No nodes being monitored" 
  FontSize="12"
      Foreground="{StaticResource TextSecondaryBrush}"
    HorizontalAlignment="Center"
     Margin="0,8,0,0"/>
       </StackPanel>
           </Grid>
            </Border>
    </Grid>
        </Grid>
    </Grid>
</UserControl>
