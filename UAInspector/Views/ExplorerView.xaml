<UserControl x:Class="UAInspector.Views.ExplorerView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="1200">
    
    <Grid Background="{DynamicResource BackgroundBrush}">
        <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
   <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="{DynamicResource SurfaceBrush}" 
   BorderBrush="{DynamicResource BorderBrush}"
         BorderThickness="0,0,0,1" Padding="24,16">
    <Grid>
    <Grid.ColumnDefinitions>
       <ColumnDefinition Width="*"/>
     <ColumnDefinition Width="Auto"/>
       </Grid.ColumnDefinitions>

         <!-- Server Info -->
  <StackPanel Grid.Column="0">
  <TextBlock Text="OPC UA Address Space Explorer" 
   Style="{DynamicResource HeaderText}"/>
    <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
        <TextBlock Text="ðŸ”—" FontSize="12" VerticalAlignment="Center" Margin="0,0,8,0"/>
<TextBlock VerticalAlignment="Center" FontSize="12" 
Foreground="{DynamicResource TextSecondaryBrush}">
  <Run Text="Connected to:"/>
       <Run Text="{Binding ServerName, Mode=OneWay}" FontWeight="SemiBold"/>
    </TextBlock>
        </StackPanel>
         </StackPanel>

       <!-- Toolbar -->
        <Button Grid.Column="1" Content="ðŸ”„ Refresh" 
        Command="{Binding RefreshCommand}"
  Style="{DynamicResource SecondaryButton}"
         Padding="16,8"/>
          </Grid>
 </Border>

    <!-- Main Content -->
        <Grid Grid.Row="1" Margin="24">
     <Grid.ColumnDefinitions>
   <ColumnDefinition Width="1.2*" MinWidth="250"/>
       <ColumnDefinition Width="8"/>
<ColumnDefinition Width="2*"/>
         </Grid.ColumnDefinitions>

 <!-- Left Panel: Folder Tree (Only Folders/Groups) -->
       <Border Grid.Column="0" Style="{DynamicResource Card}">
      <Grid>
   <Grid.RowDefinitions>
 <RowDefinition Height="Auto"/>
     <RowDefinition Height="*"/>
  </Grid.RowDefinitions>

<!-- Title -->
     <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,12">
  <TextBlock Text="ðŸ“" FontSize="18" VerticalAlignment="Center" Margin="0,0,8,0"/>
      <TextBlock Text="Folder Structure" 
      FontSize="16" FontWeight="SemiBold"
       Foreground="{DynamicResource TextPrimaryBrush}"
         VerticalAlignment="Center"/>
    </StackPanel>

 <!-- TreeView - Folders Only -->
     <TreeView Grid.Row="1" 
    ItemsSource="{Binding FolderTree}"
      Background="Transparent"
     BorderThickness="0"
           ScrollViewer.HorizontalScrollBarVisibility="Auto">
      <TreeView.ItemContainerStyle>
         <Style TargetType="TreeViewItem">
   <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"/>
    <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
      <Setter Property="Padding" Value="6"/>
    <Setter Property="Margin" Value="0,2"/>
         <EventSetter Event="Expanded" Handler="TreeViewItem_Expanded"/>
       <EventSetter Event="Selected" Handler="TreeViewItem_Selected"/>
          <Style.Triggers>
     <Trigger Property="IsSelected" Value="True">
   <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
         <Setter Property="Foreground" Value="White"/>
             </Trigger>
       <Trigger Property="IsMouseOver" Value="True">
        <Setter Property="Background" Value="{DynamicResource HoverBrush}"/>
       </Trigger>
      </Style.Triggers>
</Style>
    </TreeView.ItemContainerStyle>
      <TreeView.ItemTemplate>
  <HierarchicalDataTemplate ItemsSource="{Binding Children}">
     <StackPanel Orientation="Horizontal" Margin="2">
      <TextBlock Text="ðŸ“" FontSize="16" 
   VerticalAlignment="Center" 
     Margin="0,0,8,0"/>
 <TextBlock Text="{Binding DisplayName}" 
        VerticalAlignment="Center"
       FontSize="14"
FontWeight="Medium"/>
   </StackPanel>
       </HierarchicalDataTemplate>
    </TreeView.ItemTemplate>
      </TreeView>

       <!-- Loading Indicator -->
            <Border Grid.Row="1" 
          Background="#AA000000" 
  VerticalAlignment="Stretch"
     HorizontalAlignment="Stretch">
      <Border.Style>
  <Style TargetType="Border">
       <Setter Property="Visibility" Value="Collapsed"/>
       <Style.Triggers>
    <DataTrigger Binding="{Binding IsLoading}" Value="True">
          <Setter Property="Visibility" Value="Visible"/>
          </DataTrigger>
   </Style.Triggers>
       </Style>
         </Border.Style>
        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
   <TextBlock Text="âŒ›" FontSize="48" HorizontalAlignment="Center"/>
      <TextBlock Text="Loading..." 
      Foreground="White" 
    FontSize="14"
           Margin="0,8,0,0"
      HorizontalAlignment="Center"/>
       </StackPanel>
         </Border>
   </Grid>
        </Border>

 <!-- Splitter -->
   <GridSplitter Grid.Column="1" 
      Width="8"
             HorizontalAlignment="Stretch"
       Background="Transparent"/>

        <!-- Right Panel: Tags Table -->
 <Border Grid.Column="2" Style="{DynamicResource Card}">
       <Grid>
         <Grid.RowDefinitions>
    <RowDefinition Height="Auto"/>
             <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
         </Grid.RowDefinitions>

                <!-- Title & Refresh -->
              <Grid Grid.Row="0" Margin="0,0,0,12">
      <StackPanel Orientation="Horizontal">
          <TextBlock Text="ðŸ“Š" FontSize="18" VerticalAlignment="Center" Margin="0,0,8,0"/>
  <TextBlock Text="Tags in Folder" 
     FontSize="16" FontWeight="SemiBold"
               Foreground="{DynamicResource TextPrimaryBrush}"
        VerticalAlignment="Center"/>
        <TextBlock Text="{Binding TagsInFolder.Count, StringFormat=' ({0} tags)'}" 
            FontSize="13"
                Foreground="{DynamicResource TextSecondaryBrush}"
       VerticalAlignment="Center"
       Margin="8,0,0,0"/>
  </StackPanel>
      <Button Content="ðŸ”„" 
      Command="{Binding RefreshTagsCommand}"
             ToolTip="Refresh Tags"
    Style="{DynamicResource SecondaryButton}"
         HorizontalAlignment="Right"
      Padding="12,6"/>
    </Grid>

     <!-- Tags DataGrid -->
   <DataGrid Grid.Row="1" 
        ItemsSource="{Binding TagsInFolder}"
             SelectedItem="{Binding SelectedTag}"
 AutoGenerateColumns="False"
         CanUserAddRows="False"
     CanUserDeleteRows="False"
  CanUserReorderColumns="True"
                CanUserResizeColumns="True"
     CanUserResizeRows="False"
       CanUserSortColumns="True"
            GridLinesVisibility="Horizontal"
      HeadersVisibility="Column"
       SelectionMode="Single"
   IsReadOnly="True"
        Background="{DynamicResource SurfaceBrush}"
             Foreground="{DynamicResource TextPrimaryBrush}"
     BorderThickness="1"
      BorderBrush="{DynamicResource BorderBrush}"
  RowBackground="{DynamicResource SurfaceBrush}"
        AlternatingRowBackground="#2A2A2D"
       HorizontalGridLinesBrush="{DynamicResource BorderBrush}">
            
   <DataGrid.ColumnHeaderStyle>
     <Style TargetType="DataGridColumnHeader">
  <Setter Property="Background" Value="#2D2D30"/>
        <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
         <Setter Property="FontWeight" Value="SemiBold"/>
           <Setter Property="FontSize" Value="13"/>
    <Setter Property="Padding" Value="12,8"/>
<Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
  <Setter Property="BorderThickness" Value="0,0,1,1"/>
    <Setter Property="HorizontalContentAlignment" Value="Left"/>
             </Style>
        </DataGrid.ColumnHeaderStyle>

       <DataGrid.CellStyle>
    <Style TargetType="DataGridCell">
                <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
        <Setter Property="BorderThickness" Value="0"/>
      <Setter Property="Padding" Value="12,8"/>
        <Setter Property="Template">
         <Setter.Value>
             <ControlTemplate TargetType="DataGridCell">
         <Border Background="{TemplateBinding Background}" 
  BorderThickness="{TemplateBinding BorderThickness}"
            Padding="{TemplateBinding Padding}">
<ContentPresenter VerticalAlignment="Center"/>
       </Border>
          </ControlTemplate>
  </Setter.Value>
     </Setter>
    <Style.Triggers>
 <Trigger Property="IsSelected" Value="True">
      <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
      <Setter Property="Foreground" Value="White"/>
             </Trigger>
          </Style.Triggers>
            </Style>
    </DataGrid.CellStyle>

         <DataGrid.Columns>
               <!-- Tag Name -->
  <DataGridTextColumn Header="Tag Name" 
       Binding="{Binding DisplayName}" 
       Width="2*"
    FontWeight="SemiBold"/>
                
        <!-- Data Type -->
         <DataGridTextColumn Header="Data Type" 
   Binding="{Binding DataType}" 
         Width="1.2*">
           <DataGridTextColumn.ElementStyle>
          <Style TargetType="TextBlock">
 <Setter Property="Foreground" Value="{DynamicResource AccentBrush}"/>
                 <Setter Property="FontFamily" Value="Consolas"/>
                <Setter Property="FontSize" Value="12"/>
           </Style>
        </DataGridTextColumn.ElementStyle>
        </DataGridTextColumn>
             
     <!-- Value -->
          <DataGridTextColumn Header="Value" 
   Binding="{Binding Value}" 
            Width="1.5*">
                 <DataGridTextColumn.ElementStyle>
         <Style TargetType="TextBlock">
        <Setter Property="Foreground" Value="{DynamicResource SuccessBrush}"/>
         <Setter Property="FontWeight" Value="Bold"/>
       <Setter Property="FontSize" Value="14"/>
               </Style>
             </DataGridTextColumn.ElementStyle>
              </DataGridTextColumn>
       
              <!-- Quality -->
          <DataGridTextColumn Header="Quality" 
          Binding="{Binding Quality}" 
    Width="1*">
           <DataGridTextColumn.ElementStyle>
  <Style TargetType="TextBlock">
                <Setter Property="FontSize" Value="11"/>
         <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
        </Style>
     </DataGridTextColumn.ElementStyle>
     </DataGridTextColumn>
        
 <!-- Timestamp -->
      <DataGridTextColumn Header="Last Update" 
            Binding="{Binding Timestamp, StringFormat='{}{0:HH:mm:ss.fff}'}" 
         Width="1.2*">
             <DataGridTextColumn.ElementStyle>
<Style TargetType="TextBlock">
               <Setter Property="FontFamily" Value="Consolas"/>
         <Setter Property="FontSize" Value="12"/>
           <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
  </Style>
         </DataGridTextColumn.ElementStyle>
              </DataGridTextColumn>
  
     <!-- Writable -->
    <DataGridTemplateColumn Header="R/W" Width="60">
  <DataGridTemplateColumn.CellTemplate>
     <DataTemplate>
       <TextBlock Text="{Binding IsWritable, Converter={StaticResource BoolToRWConverter}}" 
           HorizontalAlignment="Center"
      FontWeight="Bold"
    FontSize="11">
      <TextBlock.Style>
        <Style TargetType="TextBlock">
                <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
        <Style.Triggers>
    <DataTrigger Binding="{Binding IsWritable}" Value="True">
    <Setter Property="Foreground" Value="{DynamicResource WarningBrush}"/>
     </DataTrigger>
        </Style.Triggers>
            </Style>
     </TextBlock.Style>
       </TextBlock>
         </DataTemplate>
            </DataGridTemplateColumn.CellTemplate>
    </DataGridTemplateColumn>
   </DataGrid.Columns>
      </DataGrid>

           <!-- Empty State -->
      <StackPanel Grid.Row="1" 
              VerticalAlignment="Center" 
     HorizontalAlignment="Center">
   <StackPanel.Style>
     <Style TargetType="StackPanel">
       <Setter Property="Visibility" Value="Collapsed"/>
                  <Style.Triggers>
   <DataTrigger Binding="{Binding TagsInFolder.Count}" Value="0">
      <Setter Property="Visibility" Value="Visible"/>
            </DataTrigger>
          </Style.Triggers>
       </Style>
       </StackPanel.Style>
       <TextBlock Text="ðŸ“‚" FontSize="64" 
     HorizontalAlignment="Center"
   Opacity="0.3"/>
        <TextBlock Text="Select a folder to view tags" 
          FontSize="14"
      Foreground="{DynamicResource TextSecondaryBrush}"
                HorizontalAlignment="Center"
   Margin="0,16,0,0"/>
      </StackPanel>

  <!-- Write Panel (Bottom) -->
         <Border Grid.Row="2" 
         Background="#2A2A2D"
 BorderBrush="{DynamicResource BorderBrush}"
          BorderThickness="0,1,0,0"
      Padding="16"
Margin="-16,-16,-16,-16">
   <Grid>
          <Grid.Style>
          <Style TargetType="Grid">
      <Setter Property="IsEnabled" Value="False"/>
   <Setter Property="Opacity" Value="0.5"/>
        <Style.Triggers>
       <DataTrigger Binding="{Binding CanWrite}" Value="True">
<Setter Property="IsEnabled" Value="True"/>
     <Setter Property="Opacity" Value="1"/>
  </DataTrigger>
  </Style.Triggers>
       </Style>
          </Grid.Style>

      <Grid.ColumnDefinitions>
  <ColumnDefinition Width="Auto"/>
    <ColumnDefinition Width="*"/>
     <ColumnDefinition Width="Auto"/>
    <ColumnDefinition Width="Auto"/>
           </Grid.ColumnDefinitions>

          <!-- Label -->
        <TextBlock Grid.Column="0" 
      Text="Write Value:" 
VerticalAlignment="Center"
    FontWeight="SemiBold"
     Foreground="{DynamicResource TextPrimaryBrush}"
          Margin="0,0,12,0"/>

   <!-- TextBox -->
             <TextBox Grid.Column="1" 
      Text="{Binding WriteValue, UpdateSourceTrigger=PropertyChanged}"
              Style="{DynamicResource ModernTextBox}"
     VerticalAlignment="Center"
        Margin="0,0,12,0">
              <TextBox.InputBindings>
        <KeyBinding Key="Enter" Command="{Binding WriteValueCommand}"/>
  </TextBox.InputBindings>
        </TextBox>

        <!-- Write Button -->
       <Button Grid.Column="2" 
   Content="âœï¸ Write" 
         Command="{Binding WriteValueCommand}"
         Style="{DynamicResource ModernButton}"
      Padding="20,8"
       Margin="0,0,8,0"/>

        <!-- Copy Node ID Button -->
         <Button Grid.Column="3" 
      Content="ðŸ“‹ Copy ID" 
          Command="{Binding CopyNodeIdCommand}"
        ToolTip="Copy Node ID to clipboard"
    Style="{DynamicResource SecondaryButton}"
          Padding="16,8"/>
 </Grid>
  </Border>
            </Grid>
        </Border>
    </Grid>
    </Grid>
</UserControl>
